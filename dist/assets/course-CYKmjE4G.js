import{w as m,a6 as l,z as u,ac as i,J as p,t as h,I as g,E as f,M as w,K as x,ad as b}from"./index-C19OQbm5.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";async function B(){const o=new URLSearchParams(window.location.search).get("course");if(o)try{const t=m(l,"courses",o),n=await u(t);if(n.exists()){const r={id:n.id,...n.data()};E(r);const a=window.location.origin+"/courses";window.history.pushState({},document.title,a)}else console.warn("Course not found:",o),i("Course not found.","error")}catch(t){console.error("Error loading course from URL:",t),i("Failed to load course.","error")}}async function y(){const e=document.getElementById("courseGrid");if(!e)return;e.innerHTML="";const o=document.createElement("div");o.className="flex justify-center items-center min-h-[200px]";const t=document.createElement("div");t.className="w-12 h-12 border-4 border-t-4 border-gray-500 border-t-transparent rounded-full animate-spin",o.appendChild(t),e.appendChild(o);try{const n=p(h(l,"courses"),g("name","asc")),a=(await f(n)).docs.map(s=>({id:s.id,...s.data()}));if(e.innerHTML="",a.length===0){const s=document.createElement("p");s.className="text-gray-400",s.textContent="No courses found.",e.appendChild(s);return}a.forEach(s=>{const c=createProductTile(s,"course");e.appendChild(c)})}catch(n){console.error("Error loading courses:",n),e.innerHTML="";const r=document.createElement("p");r.className="text-red-500",r.textContent="Failed to load courses.",e.appendChild(r)}}function C(){history.back(),setTimeout(()=>{showSection("coursesSection"),y()},500)}function E(e){const o=document.getElementById("courseDetailContainer");if(!o)return;o.innerHTML="";const t=document.createElement("img");t.src=e.image||"https://firebasestorage.googleapis.com/v0/b/recovery-tools.firebasestorage.app/o/videos%2FImages%2Fcourse-placeholder.png?alt=media",t.alt=e.name,t.className="w-full h-64 object-cover rounded mb-6";const n=document.createElement("h1");n.className="text-3xl font-bold mb-4",n.textContent=e.name;const r=document.createElement("p");r.className="text-gray-400 mb-6",r.textContent=e.description||"No description available.";const a=document.createElement("div");a.className="flex justify-between items-center mb-6";const s=document.createElement("span");s.className="text-green-400 text-2xl font-bold",s.textContent=`$${(e.price/100).toFixed(2)}`;const c=document.createElement("button");c.className="bg-[#407471] px-6 py-3 rounded text-white font-semibold hover:bg-[#305a56]",c.textContent="Buy Now",c.addEventListener("click",()=>redirectToPayment(e.paymentLink)),a.append(s,c);const d=document.createElement("button");d.className="mt-6 text-[#407471] hover:underline text-sm",d.textContent="‚Üê Back to Courses",d.addEventListener("click",C),o.append(t,n,r,a,d),showSection("courseDetailSection"),window.scrollTo({top:0,behavior:"smooth"})}async function I(){const o=new URLSearchParams(window.location.search).get("token");if(o)try{const t=m(l,"tokens",o),n=await u(t);if(!n.exists()){i("Invalid access code.","error");return}const r=n.data();if(r.isUsed){i("This code has already been redeemed.","error");return}await w(t,{isUsed:!0,redeemedAt:x()}),i("Access granted!","success"),unlockCourseContent(r.courseId),b()}catch(t){console.error(t),i("Something went wrong validating your code.","error")}}function D(){const e=document.getElementById("coursesSection");if(!e)return;e.classList.add("active"),e.innerHTML="";const o=document.createElement("div");o.className="text-center py-10";const t=document.createElement("h2");t.className="text-2xl font-bold text-white mb-4",t.textContent="Courses Coming Soon";const n=document.createElement("p");n.className="text-gray-400",n.textContent="Explore educational courses designed for your recovery and growth.",o.append(t,n),e.appendChild(o),e.scrollIntoView({behavior:"smooth"})}export{C as goBackToCourses,B as handleCourseFromURL,D as initCoursesPage,y as loadCourses,E as showCourseDetail,I as validateTokenFromURL};
