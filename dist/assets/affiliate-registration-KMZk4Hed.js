import{e as I,l as a,p as w,t as h,v as b,x as z,j as A,i as c,d as g,m as D,u as N}from"./index-JTWqLALI.js";import{p as T,d as L}from"./date-utils-DeoV47Ec.js";async function F(){var o;const e=I.currentUser;if(!e){a("Please log in before becoming an affiliate.","error"),window.location.href="/signup?next=/affiliate/register";return}document.getElementById("affiliateName").value=e.displayName||"",document.getElementById("affiliateEmail").value=e.email||"";const i=document.getElementById("affiliateTimezone");i&&(T(i),i.value=L()),(o=document.getElementById("affiliateRegisterForm"))==null||o.addEventListener("submit",async p=>{var m,d;p.preventDefault();const r=document.getElementById("affiliateABN").value.trim(),l=document.getElementById("affiliateBusinessName").value.trim(),y=document.getElementById("affiliatePhone").value.trim(),n=document.getElementById("affiliateAddress").value.trim(),B=document.getElementById("affiliateDescription").value.trim(),v=document.getElementById("affiliateTimezone").value,s=(m=document.getElementById("affiliateLogo"))==null?void 0:m.files[0];if(!r||!l||!n){a("Please fill out all required fields.","error");return}let f=null;if(s)try{const t=`affiliates/${e.uid}/logo.jpg`,u=w(h,t);await b(u,s),f=await z(u)}catch(t){console.error("Logo upload failed:",t),a("Logo upload failed.","error")}const E={uid:e.uid,name:e.displayName||"",email:e.email,abn:r,businessName:l,phone:y,address:n,description:B,logoUrl:f,timezone:v,approved:!0,createdAt:D()};try{await A(c(g,"affiliates",e.uid),E,{merge:!0}),await N(c(g,"users",e.uid),{role:"affiliate"}),a("Affiliate registration successful!","success"),(d=document.getElementById("affiliateRegisterForm"))==null||d.reset()}catch(t){console.error("Affiliate registration error:",t),a("Something went wrong. Please try again.","error")}})}export{F as initAffiliateRegisterForm};
