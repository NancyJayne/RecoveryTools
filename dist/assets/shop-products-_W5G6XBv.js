import{J as S,t as T,a6 as $,I as L,E as D,aa as B,ac as y,ab as F,a8 as k,ai as I,aj as M}from"./index-C-hSlrLx.js";async function H(e){const t=document.getElementById("reviews");t.innerHTML='<h4 class="text-lg font-semibold mb-2">Reviews</h4>';try{const n=S(T($,`products/${e}/reviews`),L("timestamp","desc")),a=await D(n);if(a.empty){t.innerHTML+=`
        <p class="italic text-gray-500">No reviews yet. Be the first to leave one below!</p>
      `;return}a.forEach(s=>{const{userName:i,comment:o,rating:r}=s.data(),c=document.createElement("div");c.className="mb-4",c.innerHTML=`
        <p class="font-bold">${i||"Anonymous"}</p>
        <p class="text-yellow-400 text-sm mb-1">${"★".repeat(r)}${"☆".repeat(5-r)}</p>
        <p class="text-sm text-gray-400">${o}</p>
      `,t.appendChild(c)})}catch(n){console.error("❌ Failed to load reviews:",n),t.innerHTML+='<p class="text-red-400">Error loading reviews. Please try again later.</p>'}}function R(e){const t=document.getElementById("reviewForm");t&&(t.onsubmit=async n=>{if(n.preventDefault(),!B.currentUser){y("Please log in to leave a review.","error");return}const s=document.getElementById("reviewName"),i=document.getElementById("reviewRating"),o=document.getElementById("reviewComment"),r=t.querySelector("button[type='submit']"),c=(s==null?void 0:s.value.trim())||"Anonymous",d=parseInt(i==null?void 0:i.value),l=o==null?void 0:o.value.trim();if(!d||!l){y("Please select a rating and enter a comment.","error"),o==null||o.focus();return}r.disabled=!0,r.textContent="Submitting...";try{const m=await F("review_submission");await functions.httpsCallable("submitProductReview")({productId:e,userName:c,rating:d,comment:l,token:m}),y("✅ Review submitted for approval.","success"),t.reset()}catch(m){console.error("❌ Review submission error:",m),y("Error submitting review. Please try again later.","error")}finally{r.disabled=!1,r.textContent="Submit Review"}})}async function A(e){const t=document.getElementById("relatedGrid"),n=document.getElementById("relatedSuggestions");if(!(!t||!n)){t.innerHTML="";try{const o=((await k.httpsCallable("getFirestoreProducts")({type:"Tool"})).data.products||[]).filter(r=>{var c,d;return r.id!==e.id&&r.visible!==!1&&(((c=r.tags)==null?void 0:c.some(l=>{var m;return(m=e.tags)==null?void 0:m.includes(l)}))||((d=r.tags)==null?void 0:d.includes("bundle")))}).slice(0,3);if(o.length===0){n.classList.add("hidden");return}n.classList.remove("hidden"),o.forEach(r=>{const c=N(r);c&&t.appendChild(c)})}catch(a){console.error("Failed to load related tools:",a),n.classList.add("hidden")}}}function j({title:e,description:t,url:n}){document.title=e;let a=document.querySelector('meta[name="description"]');a||(a=document.createElement("meta"),a.name="description",document.head.appendChild(a)),a.content=t;let s=document.querySelector('link[rel="canonical"]');s||(s=document.createElement("link"),s.rel="canonical",document.head.appendChild(s)),s.href=n||window.location.href}async function G(){var t;const e=document.getElementById("shopGrid");if(e){e.innerHTML=`
    <div class="flex justify-center items-center min-h-[200px]">
      <div class="w-12 h-12 border-4 border-t-4 border-gray-500 border-t-transparent rounded-full animate-spin"></div>
    </div>
  `;try{const a=await k.httpsCallable("getFirestoreProducts")({type:"Tool"}),s=Array.isArray((t=a.data)==null?void 0:t.products)?a.data.products:[];if(e.innerHTML="",s.length===0){e.innerHTML='<p class="text-gray-400">No tools available.</p>';return}s.forEach(i=>{const o=N(i);o&&e.appendChild(o)})}catch(n){console.error("Error loading products:",n),e.innerHTML='<p class="text-red-500">Failed to load products. Try refreshing.</p>',y("Failed to load products.","error"),await M({message:n.message,stack:n.stack,action:"loadProducts",metadata:{function:"getFirestoreProducts",location:"shop-products.js"}})}}}function N(e){var r,c,d;if(e.visible===!1)return null;const t=document.createElement("div");if(t.className="relative bg-gray-800 p-4 rounded-lg shadow hover:ring-2 hover:ring-[#407471]",t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.setAttribute("aria-label",`View details for ${e.name}`),t.setAttribute("aria-pressed","false"),t.addEventListener("keydown",l=>{(l.key==="Enter"||l.key===" ")&&t.click()}),t.dataset.productId=e.id,t.dataset.productName=e.name,t.dataset.productPrice=e.price,t.dataset.productImage=((r=e.images)==null?void 0:r[0])||"",t.dataset.productDescription=e.shortDescription,t.dataset.productStock=e.stock,t.dataset.productFull=JSON.stringify(e),(c=e.tags)!=null&&c.includes("featured")){const l=document.createElement("span");l.textContent="★ Featured",l.className="absolute top-2 left-2 bg-yellow-500 text-black text-xs px-2 py-1 rounded",t.appendChild(l)}const n=document.createElement("img");n.src=((d=e.images)==null?void 0:d[0])||"https://via.placeholder.com/300x300?text=Product",n.alt=e.name,n.className="w-full h-48 object-cover rounded";const a=document.createElement("h3");a.textContent=e.name,a.className="text-lg font-semibold mt-2 text-white";const s=document.createElement("p");s.textContent=e.shortDescription||"",s.className="text-sm text-gray-300 mt-1";const i=e.onSale&&e.salePrice?e.salePrice:e.price,o=document.createElement("p");if(o.innerHTML=e.onSale&&e.salePrice?`<span class="line-through text-gray-500 mr-2">
         $${(e.price/100).toFixed(2)}
       </span><span class="text-green-400 font-bold">
         $${(i/100).toFixed(2)}
       </span>`:`$${(i/100).toFixed(2)}`,o.className="mt-1",t.appendChild(n),t.appendChild(a),t.appendChild(s),t.appendChild(o),e.stock===0){const l=document.createElement("div");l.className="absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center rounded",l.innerHTML='<span class="text-white font-semibold text-lg">Out of Stock</span>',t.appendChild(l)}return t}function J(e){var E,P;const t=document.getElementById("productDetailContainer");if(t.dataset.currentId===e.id)return;t.dataset.currentId=e.id,t.innerHTML="";const n=document.getElementById("breadcrumbBackLink");n&&(n.onclick=h=>{h.preventDefault(),showTabContent("shopSection"),history.pushState({},"","/shop"),setTimeout(()=>{const b=document.getElementById("shopGrid");b&&b.scrollIntoView({behavior:"smooth"})},100)});const a=document.createElement("div");a.className="flex flex-col md:flex-row gap-10 items-start px-4 sm:px-6 md:px-8 max-w-screen-xl mx-auto";const s=document.createElement("img");s.src=((E=e.images)==null?void 0:E[0])||"https://via.placeholder.com/400x400",s.alt=e.name,s.className="w-full h-auto max-h-[400px] object-cover rounded md:max-w-[600px]";const i=document.createElement("div");i.className="flex flex-col md:w-1/2 px-4";const o=document.createElement("h2");o.textContent=e.name,o.className="text-2xl font-bold mb-2";const r=document.createElement("span"),c=e.onSale&&e.salePrice?e.salePrice:e.price;r.innerHTML=e.onSale&&e.salePrice?`<span class="line-through text-gray-500 mr-2">
         $${(e.price/100).toFixed(2)}
       </span><span class="text-green-400 font-bold">
         $${(c/100).toFixed(2)}
       </span>`:`$${(c/100).toFixed(2)}`,r.className="text-green-400 text-xl font-bold mb-2";const d=document.createElement("p");d.textContent=e.shortDescription,d.className="text-sm text-gray-300 mb-2";const l=document.createElement("p");l.textContent=e.longDescription,l.className="text-sm text-gray-400 mb-4";const m=document.createElement("ul");m.className="list-disc ml-5 text-sm text-gray-300 mb-4",(e.features||[]).forEach(h=>{const b=document.createElement("li");b.textContent=h,m.appendChild(b)});const g=document.createElement("div");g.className="flex flex-col gap-4 mb-4";const f=document.createElement("div");f.className="flex items-center gap-4";const w=document.createElement("button");w.textContent="-",w.className="bg-gray-700 text-white w-8 h-8 rounded text-lg";const x=document.createElement("span");x.textContent="1",x.className="text-white font-semibold w-8 text-center select-none";const v=document.createElement("button");v.textContent="+",v.className="bg-gray-700 text-white w-8 h-8 rounded text-lg";let u=1;w.onclick=()=>{u>1&&(u--,x.textContent=u)},v.onclick=()=>{u++,x.textContent=u},f.appendChild(w),f.appendChild(x),f.appendChild(v);const p=document.createElement("button");p.className="bg-[#407471] text-white px-4 py-2 rounded w-fit",p.textContent=e.stock===0?"Out of Stock":"Add to Cart",p.disabled=e.stock===0,p.disabled?p.classList.add("opacity-50","cursor-not-allowed"):p.addEventListener("click",()=>{var h;I({id:e.id,name:e.name,price:c,quantity:u,type:e.type||"tool",creatorId:e.creatorId,affiliatePercent:e.affiliatePercent,image:(h=e.images)==null?void 0:h[0]})}),g.appendChild(f),g.appendChild(p);const C=document.createElement("button");C.className="text-[#ffffff] hover:underline mt-4 block",C.textContent="← Back to Shop",C.onclick=()=>{showSection("shopSection"),window.history.pushState({},"","/shop")},i.appendChild(o),i.appendChild(r),i.appendChild(d),i.appendChild(l),i.appendChild(m),i.appendChild(g),i.appendChild(C),a.appendChild(s),a.appendChild(i),t.appendChild(a),H(e.id),R(e.id),A(e),window.history.pushState({},"",`/shop/${e.slug}`),j({title:`${e.name} | Recovery Tools`,description:e.shortDescription||((P=e.longDescription)==null?void 0:P.slice(0,140)),url:`https://recoverytools.au/shop/${e.slug}`}),q(e),showSection("productDetailSection"),window.scrollTo({top:0,behavior:"smooth"})}function q(e){var n;const t=document.createElement("script");t.type="application/ld+json",t.innerHTML=JSON.stringify({"@context":"https://schema.org","@type":"Product",name:e.name,image:(n=e.images)==null?void 0:n[0],description:e.shortDescription||e.longDescription,sku:e.slug,brand:{"@type":"Organization",name:"Recovery Tools"},offers:{"@type":"Offer",priceCurrency:"AUD",price:(e.salePrice||e.price)/100,availability:e.stock>0?"InStock":"OutOfStock",url:`https://recoverytools.au/shop/${e.slug}`}}),document.head.appendChild(t)}export{j as a,G as l,J as s};
