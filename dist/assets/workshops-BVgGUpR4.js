import{aa as M,ah as $,E as B,J as R,t as A,a6 as H,N as W,I as F,ac as U}from"./index-C19OQbm5.js";import{D as b,f as O}from"./date-utils-B0NO50wt.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";function L(e,a="Australia/Sydney",t=!1){const i=b.fromJSDate(new Date(e),{zone:a});return(t?i.plus({hours:1}):i).toUTC().toFormat("yyyyLLdd'T'HHmmss'Z'")}const k=Intl.DateTimeFormat().resolvedOptions().timeZone,N=document.getElementById("workshopGrid");document.getElementById("workshopDetailContainer");const w=document.getElementById("pastWorkshopGrid"),p=document.getElementById("filterLocation"),u=document.getElementById("filterTag");let C=[];function G(e,a=k){const t=document.getElementById("workshopDetailContainer");if(!t)return;let i="Date not set",n=null;if(e.dateUTC&&e.timezone){const o=b.fromISO(e.dateUTC,{zone:"utc"}).setZone(a);i=o.toFormat("dd/MM/yyyy hh:mm a")+` (${a})`,n=new Date(o.toISO())}const c=e.location?encodeURIComponent(e.location):null,r=c?`https://www.google.com/maps/search/?api=1&query=${c}`:null,g=n?`https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(e.name)}&dates=${L(n)}/${L(n,!0)}&details=${encodeURIComponent(e.description||"")}&location=${encodeURIComponent(e.location||"")}`:null;t.textContent="";const l=document.createElement("img");l.src=e.image||"https://firebasestorage.googleapis.com/v0/b/recovery-tools.firebasestorage.app/o/videos%2FImages%2Fworkshop-placeholder.png?alt=media",l.alt=e.name,l.className="w-full h-64 object-cover rounded mb-6",t.appendChild(l);const h=document.createElement("h1");h.textContent=e.name,h.className="text-3xl font-bold mb-4",t.appendChild(h);const f=document.createElement("div");f.className="text-gray-400 mb-2",f.innerHTML=`<strong>Date:</strong> ${i}`,t.appendChild(f);const d=document.createElement("div");d.className="text-gray-400 mb-6",d.innerHTML=`<strong>Location:</strong> ${e.location||"Location not set"}`,t.appendChild(d);const s=document.createElement("p");s.className="text-gray-400 mb-6",s.textContent=e.description||"No description available.",t.appendChild(s);const m=document.createElement("div");m.className="flex flex-wrap gap-3 mb-6 items-center";const v=document.createElement("span");v.className="text-green-400 text-2xl font-bold",v.textContent=`$${(e.price/100).toFixed(2)}`,m.appendChild(v);const T=document.createElement("button");if(T.className="bg-[#407471] px-6 py-3 rounded text-white font-semibold hover:bg-[#305a56]",T.textContent="Register Now",T.onclick=()=>redirectToPayment(e.paymentLink),m.appendChild(T),r){const o=document.createElement("a");o.href=r,o.target="_blank",o.className="bg-blue-600 px-4 py-2 rounded text-white font-semibold hover:bg-blue-700 flex items-center gap-2",o.innerHTML="üìç <span>View Location</span>",m.appendChild(o)}if(g){const o=document.createElement("a");o.href=g,o.target="_blank",o.className="bg-yellow-500 px-4 py-2 rounded text-white font-semibold hover:bg-yellow-600 flex items-center gap-2",o.innerHTML="üóïÔ∏è <span>Add to Google Calendar</span>",m.appendChild(o);const E=document.createElement("button");E.className="bg-purple-600 px-4 py-2 rounded text-white font-semibold hover:bg-purple-700 flex items-center gap-2",E.innerHTML="üóìÔ∏è <span>Add to iCal</span>",E.onclick=()=>j(e.name,n.toISOString(),e.location||"",e.description||""),m.appendChild(E)}if(M.currentUser){const o=document.createElement("button");o.className="bg-indigo-600 px-4 py-2 rounded text-white font-semibold hover:bg-indigo-700 flex items-center gap-2",o.innerHTML="üì£ <span>Promote This Event</span>",o.onclick=()=>copyReferralLink(e.id),m.appendChild(o)}const y=document.createElement("button");y.className="bg-gray-700 px-4 py-2 rounded text-white font-semibold hover:bg-gray-800 flex items-center gap-2",y.innerHTML="üí¨ <span>Share This Workshop</span>",y.onclick=()=>copyWorkshopLink(e.id),m.appendChild(y),t.appendChild(m);const x=document.createElement("button");x.className="mt-6 text-[#407471] hover:underline text-sm",x.textContent="‚Üê Back to Workshops",x.onclick=P,t.appendChild(x),$("workshopDetailSection"),window.scrollTo({top:0,behavior:"smooth"})}async function S(){try{C=(await B(R(A(H,"workshops"),W("visible","==",!0),F("dateUTC","desc")))).docs.map(a=>({id:a.id,...a.data()})),D(),V()}catch(e){console.error("Failed to load workshops:",e),U("Failed to load workshops.","error")}}function D(){const e=b.now().toUTC(),a=k;N.innerHTML="",w.innerHTML="";const t=C.filter(n=>{var l,h;const c=b.fromISO(n.dateUTC).toUTC()>e,r=!(p!=null&&p.value)||((l=n.location)==null?void 0:l.includes(p.value)),g=!(u!=null&&u.value)||((h=n.tags)==null?void 0:h.includes(u.value));return r&&g&&c}),i=C.filter(n=>b.fromISO(n.dateUTC).toUTC()<=e);for(const n of t){const c=I(n,a);N.appendChild(c)}for(const n of i){const c=I(n,a);w.appendChild(c)}}function I(e,a){const t=document.createElement("div");return t.className="bg-gray-800 p-4 rounded shadow cursor-pointer hover:bg-gray-700",t.innerHTML=`
    <h3 class="text-lg font-bold text-white mb-1">${e.title}</h3>
    <p class="text-sm text-gray-400">üìç ${e.location||"TBA"}</p>
    <p class="text-sm text-gray-400">üïí ${O(e,a)} (${a})</p>
  `,t.addEventListener("click",()=>G(e)),t}function V(){const e=[...new Set(C.map(t=>t.location).filter(Boolean))],a=[...new Set(C.flatMap(t=>t.tags||[]))];p&&(p.innerHTML='<option value="">All Locations</option>'+e.map(t=>`<option value="${t}">${t}</option>`).join("")),u&&(u.innerHTML='<option value="">All Tags</option>'+a.map(t=>`<option value="${t}">${t}</option>`).join("")),p==null||p.addEventListener("change",D),u==null||u.addEventListener("change",D)}function P(){history.back(),setTimeout(()=>{$("workshopsSection"),S()},500)}function j(e,a,t,i){const n=new Date(a),c=new Date(n.getTime()+60*60*1e3),r=s=>s<10?"0"+s:s,g=s=>s.getUTCFullYear()+r(s.getUTCMonth()+1)+r(s.getUTCDate())+"T"+r(s.getUTCHours())+r(s.getUTCMinutes())+r(s.getUTCSeconds())+"Z",l=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//RecoveryTools Workshop//EN","BEGIN:VEVENT",`UID:${Date.now()}@recoverytools`,`DTSTAMP:${g(new Date)}`,`DTSTART:${g(n)}`,`DTEND:${g(c)}`,`SUMMARY:${e}`,`DESCRIPTION:${i}`,`LOCATION:${t}`,"END:VEVENT","END:VCALENDAR"].join(`\r
`),h=new Blob([l],{type:"text/calendar;charset=utf-8"}),f=URL.createObjectURL(h),d=document.createElement("a");d.href=f,d.download=`${e.replace(/\s+/g,"_")}.ics`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(f),U("Workshop added to your calendar!","success")}function K(){S()}export{j as downloadICS,P as goBackToWorkshops,K as initWorkshopsPage,S as loadWorkshops,G as showWorkshopDetail};
